% create random field with autocorrelation

% sample the field
n = 82;
x = [10.816005833333334,10.8159846,10.8159626,10.815985,10.8159382,10.815886,10.815888142857144,10.815876666666666,10.815853166666665,10.815938800000001,10.815896714285714,10.8158916,10.81594475,10.815903727272728,10.815895875,10.815905444444445,10.8159226,10.815916,10.815944,10.815939428571427,10.815971166666666,10.81599075,10.816010333333333,10.816085,10.8160425,10.8160225,10.816028625,10.816046777777778,10.816077,10.8161115,10.816129000000002,10.8161205,10.8161525,10.816165666666668,10.816136199999999,10.816136799999999,10.8161535,10.816167400000001,10.816183,10.816179571428572,10.816166333333333,10.816145833333332,10.816138833333333,10.816125285714284,10.816103833333335,10.816082833333333,10.816061499999998,10.816024142857144,10.816035333333332,10.816021428571428,10.8160392,10.8160162,10.816005166666665,10.816001333333332,10.8159946,10.815959666666666,10.8159225,10.8159115,10.815910142857144,10.8158858,10.815857000000001,10.815860285714285,10.815845,10.815846333333333,10.815853857142857,10.815851875,10.815867555555556,10.815876583333333,10.81602625,10.816050125,10.816064399999998,10.816067833333333,10.816098,10.816130714285716,10.8161408,10.816157714285714,10.816137428571428,10.816132714285715,10.816147,10.816130444444445,10.816153428571429,10.816147714285714,10.8161434]';
y = [-74.17030066666666,-74.1702758,-74.170282,-74.1703094,-74.170265,-74.170223,-74.170258,-74.1702615,-74.17026033333333,-74.1703404,-74.17033585714285,-74.170311,-74.17033925,-74.17036272727273,-74.17038,-74.170372,-74.17042819999999,-74.17039842857142,-74.170392,-74.1703662857143,-74.17040033333332,-74.170389,-74.17033116666666,-74.170357,-74.17025475,-74.17025875,-74.17029099999999,-74.17023733333333,-74.170251,-74.170242375,-74.170231,-74.170248,-74.1702401,-74.17025,-74.170294,-74.1702912,-74.17028,-74.1702912,-74.17031766666668,-74.17037528571429,-74.17036800000001,-74.17038983333333,-74.17040033333332,-74.17038,-74.17038,-74.17037466666666,-74.170387,-74.17026614285714,-74.17020166666667,-74.17019900000001,-74.170204,-74.1701782,-74.17014033333334,-74.170128,-74.1701382,-74.17015933333333,-74.17015216666667,-74.17013033333335,-74.17011042857143,-74.1701368,-74.17016344444444,-74.1701682857143,-74.1701867142857,-74.170208,-74.17023042857143,-74.17026325,-74.17028011111113,-74.17029,-74.170143,-74.1701155,-74.1701018,-74.17010766666668,-74.1701144,-74.170105,-74.1701172,-74.170105,-74.170113,-74.17013399999999,-74.17020855555556,-74.17017477777777,-74.17018014285713,-74.17020857142857,-74.1702262]';
[X,Y] = meshgrid(linspace(min(x), max(x), 82), linspace(min(y), max(y), 82));
Z = randn(size(X));
z = [32.83766666666667,35.812,34.53060000000001,35.3974,30.8296,30.144000000000002,30.20042857142857,30.419999999999998,31.7045,33.902300000000004,32.38142857142857,29.2896,29.551000000000002,30.026090909090907,31.08725,30.551000000000002,29.9548,29.158142857142856,28.972125,28.878714285714288,30.610833333333332,31.667,35.413000000000004,35.4965,35.75775,31.066125,30.70675,29.93688888888889,30.45025,29.099875,33.06016666666667,31.59475,30.6512,30.495666666666665,33.1268,32.3552,32.56675,32.2658,32.258,31.035,30.557333333333332,30.489666666666665,31.7885,29.834,30.388499999999997,31.4545,32.419333333333334,32.038428571428575,33.63216666666667,33.35214285714286,33.5216,33.1434,30.653666666666666,30.465833333333332,29.5928,29.9245,31.248,29.888333333333335,30.041,30.9784,30.104555555555553,29.828285714285716,29.95114285714286,30.512833333333333,30.36057142857143,31.844125,31.129222222222225,32.19325,32.839999999999996,31.262,30.711599999999997,30.620833333333334,30.5094,30.190285714285714,31.2548,30.934,30.87242857142857,32.42742857142857,29.93488888888889,31.355222222222224,31.04942857142857,32.011857142857146,32.4948]';

% calculate the sample variogram
v = variogram([x y], z,'plotit', true, 'nrbins', 20);
% and fit a exponential variogram
figure
subplot(2,2,1)
[~,~,~,vstruct] = variogramfit(v.distance,v.val,[],[],[],'model','gaussian', 'nugget',0);
title('Variograma')

%now use the sampled locations in a kriging
[Zhat,Zvar] = kriging(vstruct,x,y,z,X,Y);
subplot(2,2,2)
imagesc(X(1,:),Y(:,1),Zhat); axis image; axis xy
title('Predicción de Kriging')
subplot(2,2,3)
contour(X,Y,Zvar); 
axis image
title('Mapa de Varianza')

subplot(2,2,4)
surf(X,Y,Zhat)
%shading interp 
title('Mapa de predicción de Kriging')

